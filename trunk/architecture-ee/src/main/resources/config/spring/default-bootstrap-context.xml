<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd"
	default-autowire="no" 
	default-lazy-init="false"
	default-init-method="init" 
	default-destroy-method="destroy">
	<description>
	<![CDATA[
        Define Bootstrap Context
	]]>
	</description>
	<!-- ================================================ -->	
	<!--  Task & Jobs                                     -->
	<!-- ================================================ -->	
	<!-- Global Timer for timed execution tasks. -->
	<!-- Spring task executor replaces the custom task engine. -->
	<!-- 
	<bean id="taskTimer" class="org.springframework.scheduling.timer.TimerFactoryBean" p:daemon="false" />   
    <bean id="minuteTaskExecutor" class="org.springframework.scheduling.timer.TimerTaskExecutor" p:delay="6000" p:timer-ref="taskTimer"  depends-on="taskTimer" />
    -->
    <!-- 
	<bean id="taskTimer" class="org.springframework.scheduling.timer.TimerFactoryBean" p:daemon="true" />
	
	<bean id="taskEngine" class="architecture.common.util.TaskEngine" > 
		<constructor-arg index="0" ref="taskTimer"/>
	</bean>
	-->
	<bean id="taskEngine" class="architecture.ee.util.task.TaskEngine">
		<constructor-arg index="0" ref="adminService"/>
	</bean> 

	<!-- ================================================ -->	
	<!--  Event                                           -->
	<!-- ================================================ -->	
	
	<bean id="eventThreadPoolConfiguration" class="architecture.common.event.internal.EventThreadPoolConfigurationImpl" />
	
	<bean id="listenerHandlerConfiguration" class="architecture.common.event.internal.ListenerHandlerConfigurationImpl" />

	<bean id="eventExecutorFactory" class="architecture.common.event.internal.EventExecutorFactoryImpl" depends-on="eventThreadPoolConfiguration" >
		<constructor-arg index="0" ref="eventThreadPoolConfiguration"/>
	</bean>

	<bean id="eventDispatcher" class="architecture.common.event.internal.AsynchronousAbleEventDispatcher" depends-on="eventExecutorFactory">
		<constructor-arg index="0" ref="eventExecutorFactory"/>
    </bean>

	<bean id="eventPublisher" class="architecture.common.event.internal.EventPublisherImpl" depends-on="eventDispatcher, listenerHandlerConfiguration">
		<constructor-arg index="0" ref="eventDispatcher"/>
		<constructor-arg index="1" ref="listenerHandlerConfiguration"/>
	</bean>
	
	<!-- ================================================ -->	
	<!--  Plugin                                          -->
	<!-- ================================================ -->	
	
	<bean id="pluginCacheRegistry" class="architecture.common.plugin.internal.PluginCacheRegistryImpl" depends-on="ehcache" >
	    <constructor-arg index="0" ref="ehcache"/>
	</bean>	
	
	<bean id="pluginManager" class="architecture.ee.spring.lifecycle.internal.PluginManagerImpl" 
	    p:eventPublisher-ref="eventPublisher" 
	    p:taskEngine-ref="taskEngine" />	
	
	<!-- ================================================ -->	
	<!--  Cache                                           -->
	<!-- ================================================ -->	
	<bean id="ehcache"      class="org.springframework.cache.ehcache.EhCacheManagerFactoryBean" p:shared="false" />	
	<!-- ================================================ -->	
	<!--  Application                                     -->
	<!-- ================================================ -->	
	
	<bean id="contextLoader" class="architecture.ee.spring.context.WebApplicationContextLoader" />	
	<bean id="configRootHelper" class="architecture.ee.spring.lifecycle.internal.ConfigRootHelperImpl"/>	
	<bean id="adminService" class="architecture.ee.spring.lifecycle.internal.AdminServiceImpl" init-method="initialize" depends-on="eventPublisher"
		p:eventPublisher-ref="eventPublisher" 
		p:contextLoader-ref="contextLoader" 
		p:configRootHelper-ref="configRootHelper" />
	
	<!-- ================================================ -->	
	<!--  Database                                        -->
	<!-- ================================================ -->	
	<bean id="sqlConfiguration" class="architecture.ee.jdbc.query.factory.ConfigurationFactory" factory-method="getConfiguration" />
	
	<bean id="sqlQueryFactoryBuilder" class="architecture.ee.spring.jdbc.SqlQueryFactoryBuilder" init-method="initialize">
	    <constructor-arg index="0" ref="sqlConfiguration"/>
		<property name="resourceLocations">
			<list>
				<value>res:config/sql/framework-queryset.xml</value>
			</list>
		</property>
	</bean>		
	
</beans>