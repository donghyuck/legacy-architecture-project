<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE struts PUBLIC
    "-//Apache Software Foundation//DTD Struts Configuration 2.0//EN"
    "http://struts.apache.org/dtds/struts-2.0.dtd">
<struts>

	<package name="framework-struts-default" extends="struts-default">
		<!-- Result Type Overrides and Additions -->
		<result-types>
			<result-type name="freemarker" class="architecture.ee.web.struts2.view.freemarker.ExtendedFreemarkerResult" default="true" />
			<result-type name="json" class="org.apache.struts2.json.JSONResult"/>
		</result-types>
        
		<!-- Interceptor overrides and additions -->
		<interceptors>
			<interceptor name="validation" class="architecture.ee.web.struts2.interceptor.ExtendedValidationInterceptor">
				<param name="excludeMethods">input,back,cancel,default,withRedirect,removeAttach,doCancel,delete,reply,skip</param>
			</interceptor>			
			<!-- Validation interceptor - only registered to executing methods, customized for NoValidation annotation -->
			<interceptor name="prepare" class="architecture.ee.web.struts2.interceptor.ExtendedMethodFilterInterceptor" />			
			<!-- sets the current executing action in the session for redirection -->
			<interceptor name="referer" class="architecture.ee.web.struts2.interceptor.RefererInterceptor" />
            <!-- Helper to set the ActionContext Locale to the user's locale (if specified) -->
            <interceptor name="locale" class="architecture.ee.web.struts2.interceptor.LocaleInterceptor"/>
			<!-- A complete stack with all the common interceptors in place. Generally, 
				this stack should be the one you use, though it may do more than you need. 
				Also, the ordering can be switched around (ex: if you wish to have your prepare() 
				method called interceptor up.servlet-related. before your servlet related 
				objects, you need to move the prepare This stack also excludes the validation 
				and workflow the method names input,back,cancel,default,withRedirect, removeAttach,doCancel, 
				reply and delete. These typically are associated with requests that should 
				not be validated. -->
			<interceptor name="json" class="org.apache.struts2.json.JSONInterceptor"/>	
						
			<interceptor-stack name="defaultStack">
				<interceptor-ref name="referer" />
				<interceptor-ref name="servletConfig" />
				<interceptor-ref name="prepare" />
				<interceptor-ref name="params"/>
				<interceptor-ref name="locale"/>
				<interceptor-ref name="validation"/>
			</interceptor-stack>	
					
			<interceptor-stack name="includeStack">
				<interceptor-ref name="servletConfig" />
				<interceptor-ref name="prepare" />
				<interceptor-ref name="params"/>
				<interceptor-ref name="locale"/>
				<interceptor-ref name="validation" />
			</interceptor-stack>			
		</interceptors>
		<!-- The default interceptor stack applied to all actions -->
		<default-interceptor-ref name="defaultStack" />
		<global-results>
			<result name="login" type="redirect">/accounts/login.do</result>
			<result name="none" type="httpheader">204</result>
		</global-results>
		<global-exception-mappings>
			<exception-mapping exception="architecture.ee.security.UnauthorizedException" result="unauthorized" />
			<exception-mapping exception="java.lang.Exception" result="error" />
		</global-exception-mappings>
		<!-- Included Actions: These actions do not exist on thier own and are 
			 only referenced by an action include tag -->
	</package>
	
	<package name="framework-actions" extends="framework-struts-default" namespace="/">		
		<action name="main" class="architecture.ee.web.struts2.action.MainAction">
			<result name="success">${ dataType == "html" ? "/template/default/html/main.ftl" : "/template/default/success.ftl" }</result>
		</action>				
		<action name="error" class="architecture.ee.web.struts2.action.ErrorAction">
			<result name="success">/template/default/error.ftl</result>
		</action>		
	</package>
	
	<package name="framework-accounts-actions" extends="framework-struts-default" namespace="/accounts">		
		<action name="login" class="architecture.ee.web.struts2.action.LoginAction">
			<result name="cancel" type="redirect">${cancelURL? != null ? cancelURL : "/main.do"}</result>
			<result name="input">/template/default/html/login.ftl</result>
			<result name="unauthenticated">${ dataType == "html" ? "/template/default/html/login.ftl" : "/template/default/xml/authenticate-error.ftl" }</result>
			<result name="success">${ dataType == "html" ? ( successURL != null ? successURL : "/main.do" ) : "/template/default/xml/authenticate-success.ftl" }</result>
			<result name="create-profile" type="redirect">create-account.do?username=${username}</result>
		</action>					
	</package>

</struts>