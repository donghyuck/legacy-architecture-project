<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:security="http://www.springframework.org/schema/security"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:p="http://www.springframework.org/schema/p"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
          http://www.springframework.org/schema/beans/spring-beans.xsd
          http://www.springframework.org/schema/security
          http://www.springframework.org/schema/security/spring-security.xsd">

    <!-- ************************************************************************** -->
    <!-- Authentication configuration                                               -->
    <!-- ************************************************************************** -->
    
	<security:global-method-security pre-post-annotations="enabled" />

	<security:http auto-config="false" entry-point-ref="formAuthenticationEntryPoint">
		<security:intercept-url pattern="/images/*" filters="none" />
		<security:intercept-url pattern="/styles/*" filters="none" />	
		<security:intercept-url pattern="/scripts/*" filters="none" />	
		<security:intercept-url pattern="/includes/*" filters="none" />
		<security:intercept-url pattern="/accounts/**" access="IS_AUTHENTICATED_ANONYMOUSLY" />
		<security:custom-filter position="ANONYMOUS_FILTER" ref="anonymousAuthenticationFilter" />
		<security:custom-filter position="FORM_LOGIN_FILTER" ref="formAuthenticationFilter" />
	</security:http>

	<!-- ************************************************************************** -->
    <!-- Filter configuration                                                       -->
    <!-- ************************************************************************** -->
    
    <bean id="anonymousAuthenticationFilter"
        class="architecture.ee.spring.security.authentication.ExtendedAnonymousAuthenticationFilter">
    	<constructor-arg index="0" value="1234567890abcdefghijklmnopqrstuvwxyz"/> 
    	<constructor-arg index="1" value="ANONYMOUS"/> 
    	<constructor-arg index="2" value="ROLE_ANONYMOUS"/>    
    </bean>
        
	<bean id="formAuthenticationFilter" class="architecture.ee.spring.security.authentication.ExtendedAuthenticationProcessingFilter"
	    p:authenticationManager-ref="authenticationManager"
		p:userManager-ref="userManager"
		p:usernameParameter="username"
		p:passwordParameter="password"
		p:filterProcessesUrl="/accounts/authenticate"
		p:authenticationFailureUrl="/accounts/login.do?authnFailed=true"
		p:defaultTargetUrl="/accounts/login.do" />
    		                
	<bean id="formAuthenticationEntryPoint"
	    class="architecture.ee.spring.security.authentication.ExtendedAuthenticationProcessingFilterEntryPoint"
	    p:loginFormUrl="/accounts/login.do" />
	        		                
    <!-- ************************************************************************** -->
    <!-- Authentication configuration                                               -->
    <!--  authenticationManager, daoAuthenticationProvider, userDetailsService      -->
    <!-- ************************************************************************** -->    
    
    <security:authentication-manager alias="authenticationManager" >
        <security:authentication-provider ref="daoAuthenticationProvider" />
    </security:authentication-manager>

	<bean id="daoAuthenticationProvider" class="architecture.ee.spring.security.authentication.ExtendedDaoAuthenticationProvider" 
        p:userManager-ref="userManager"
        p:passwordEncoder-ref="passwordEncoder"
        p:saltSource-ref="passwordSaltSource"
        p:userDetailsService-ref="userDetailsService" />
        
	<bean id="userDetailsService" class="architecture.ee.spring.security.authentication.ExtendedUserDetailsService"
	    p:eventPublisher-ref="eventPublisher"
	    p:userManager-ref="userManager"
	    p:roleManager-ref="roleManager" 
	    p:grantedAuthority="ROLE_USER" >
	    <constructor-arg index="0" value="true"/>
	</bean>
	
    <bean id="authenticationProvider" class="architecture.ee.spring.security.authentication.SecurityContextAuthenticationProviderImpl" scope="prototype">
    </bean>	

</beans>                        